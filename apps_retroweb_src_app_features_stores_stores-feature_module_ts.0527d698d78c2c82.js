"use strict";(self.webpackChunkretroweb=self.webpackChunkretroweb||[]).push([["apps_retroweb_src_app_features_stores_stores-feature_module_ts"],{73234:(re,T,n)=>{n.r(T),n.d(T,{COMPONENTS:()=>ee,CONTAINERS:()=>te,ROUTES:()=>F,StoresFeatureModule:()=>ae});var b=n(15183),c=n(94666),d=n(97364),G=n(63227),_=n(39878),g=n(50253),u=n(68951),O=n(50635),w=n(60116),N=n(98977),p=n(32673),J=n(91640),f=n(10745),m=n(1039),$=n(85058),A=n(3651),h=n(34579),S=n(43654),C=n(70367),x=n(40729),q=n(19028),e=n(22560),P=n(52756),D=n(75584);function R(o,s){1&o&&(e.ynx(0),e.TgZ(1,"button",3)(2,"span",4),e._uU(3,"'96 Zenkoku Koukou Soccer Senshuken (Japan)"),e.qZA()(),e.TgZ(4,"button",3)(5,"span",4),e._uU(6,"7th Saga, The (USA)"),e.qZA()(),e.TgZ(7,"button",3)(8,"span",4),e._uU(9,"Donkey Kong Country (USA) (Rev 2)"),e.qZA()(),e.TgZ(10,"button",3)(11,"span",4),e._uU(12,"Final Fantasy III (USA) (Rev 1)"),e.qZA()(),e.TgZ(13,"button",3)(14,"span",4),e._uU(15,"Legend of Zelda, The - A Link to the Past (USA)"),e.qZA()(),e.TgZ(16,"button",3)(17,"span",4),e._uU(18,"Super Mario Kart (USA)"),e.qZA()(),e.TgZ(19,"button",3)(20,"span",4),e._uU(21,"Super Mario World (USA)"),e.qZA()(),e.TgZ(22,"button",3)(23,"span",4),e._uU(24,"Tetris & Dr. Mario (USA)"),e.qZA()(),e.TgZ(25,"button",3)(26,"span",4),e._uU(27,"Undake 30 - Same Game Daisakusen - Mario Version (Japan)"),e.qZA()(),e.TgZ(28,"button",3)(29,"span",4),e._uU(30,"Zaitaku Touhyou System - SPAT4-Wide (Japan) (TOBJ)"),e.qZA()(),e.BQk())}function M(o,s){1&o&&(e.TgZ(0,"span"),e._uU(1,"\u2b50\xa0"),e.qZA())}function Y(o,s){if(1&o&&(e.TgZ(0,"span",7),e._uU(1),e.qZA()),2&o){const t=e.oxw().ngIf;e.xp6(1),e.Oqu(t.name)}}function k(o,s){if(1&o&&(e.ynx(0),e.YNc(1,Y,2,1,"span",6),e.BQk()),2&o){const t=s.ngIf;e.xp6(1),e.Q6J("ngIf",t.name)}}function L(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){const i=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.handleSelectGame(i))}),e.YNc(1,M,2,0,"span",1),e.TgZ(2,"span"),e._uU(3),e.qZA(),e._uU(4),e.YNc(5,k,2,1,"ng-container",1),e.ALo(6,"async"),e.qZA()}if(2&o){const t=s.$implicit,a=e.oxw();e.xp6(1),e.Q6J("ngIf",a.isGameInCollection(t)),e.xp6(2),e.Oqu(a.getGameLabel(t)),e.xp6(1),e.hij(" "," "," "),e.xp6(1),e.Q6J("ngIf",e.lcZ(6,4,a.softwaresFacade.selectSoftwareState(a.gameToSoftwareRef(t))))}}function Q(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"aside",9)(1,"h2",10,11),e._uU(3),e.qZA(),e.TgZ(4,"dl",12)(5,"dt"),e._uU(6,"Platform"),e.qZA(),e.TgZ(7,"dd"),e._uU(8),e.qZA(),e.TgZ(9,"dt"),e._uU(10,"Version"),e.qZA(),e.TgZ(11,"dd"),e._uU(12),e.qZA(),e.TgZ(13,"dt"),e._uU(14,"File"),e.qZA(),e.TgZ(15,"dd"),e._uU(16),e.qZA(),e.TgZ(17,"dt"),e._uU(18,"Size"),e.qZA(),e.TgZ(19,"dd"),e._uU(20),e.qZA(),e.TgZ(21,"dt"),e._uU(22,"CID"),e.qZA(),e.TgZ(23,"dd"),e._uU(24),e.qZA(),e.TgZ(25,"dt"),e._uU(26,"CRC32"),e.qZA(),e.TgZ(27,"dd"),e._uU(28),e.qZA(),e.TgZ(29,"dt"),e._uU(30,"MD5"),e.qZA(),e.TgZ(31,"dd"),e._uU(32),e.qZA(),e.TgZ(33,"dt"),e._uU(34,"SHA-1"),e.qZA(),e.TgZ(35,"dd"),e._uU(36),e.qZA(),e.TgZ(37,"dt"),e._uU(38,"SHA-256"),e.qZA(),e.TgZ(39,"dd"),e._uU(40),e.qZA()(),e.TgZ(41,"div",13)(42,"button",14),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handleGameSelectedCancel())}),e._uU(43," Back "),e.qZA(),e.TgZ(44,"button",14),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handleAddGame(r.gameSelected))}),e._uU(45," Play "),e.qZA()()()}if(2&o){const t=e.MAs(2),a=e.oxw(2);e.Q6J("uiAriaLabelledby",t),e.xp6(3),e.hij(" ",a.getGameName(a.gameSelected)," "),e.xp6(5),e.Oqu(a.platform.name),e.xp6(4),e.Oqu(a.getGameVersion(a.gameSelected)),e.xp6(4),e.Oqu(a.gameSelected.name),e.xp6(4),e.AsE("",a.gameSelected.size," (",a.getGameHumanSize(a.gameSelected),")"),e.xp6(4),e.Oqu(a.gameSelected.cid),e.xp6(4),e.AsE("",a.getGameCrcDecimal(a.gameSelected)," (0x",a.gameSelected.crc,")"),e.xp6(4),e.Oqu(a.gameSelected.md5),e.xp6(4),e.Oqu(a.gameSelected.sha1),e.xp6(4),e.Oqu(a.gameSelected.sha256),e.xp6(2),e.Q6J("disabled",!1),e.uIk("tabindex",0),e.xp6(2),e.Q6J("disabled",!1),e.uIk("tabindex",0)}}function E(o,s){if(1&o){const t=e.EpF();e.YNc(0,Q,46,17,"ng-template",8),e.NdJ("overlayKeydownEscape",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleGameSelectedCancel())})}}let v=(()=>{class o{constructor(t,a,r,i,l,Z){this.layoutFacade=t,this.softwaresFacade=a,this.routerFacade=r,this.dataService=i,this.softwaresService=l,this.changeDetectorRef=Z,this.cssClassPlatformStorePage=!0,this.games=[],this.loaded=!1,this.gameSelected=null,this.destroyed$=new g.x,this.updateGamesCollection$=new g.x,this.gamesCollectionSubscription=null,this.gamesCollectionIds=[]}get placeholderItemsIndexes(){return new Array(8)}ngOnInit(){this.routerFacade.routeParams$.pipe((0,u.R)(this.destroyed$),(0,O.U)(({platform:t})=>this.dataService.getPlatform(t)),(0,w.h)(t=>!!t),(0,N.x)(),(0,p.w)(t=>(0,J.D)({platform:(0,f.of)(t),gamesMap:this.getGamesRegistry(t)}))).subscribe(({platform:t,gamesMap:a})=>{this.loaded=!0,this.platform=t,this.games=Object.entries(a).map(([,r])=>r).filter(r=>!/(\[bios\]|test program)/i.test(r.name)),this.changeDetectorRef.markForCheck(),this.gamesCollectionSubscription?.unsubscribe(),this.gamesCollectionSubscription=this.softwaresFacade.allGames$.pipe((0,u.R)(this.destroyed$)).subscribe(()=>this.updateGamesCollection$.next())}),this.updateGamesCollection$.pipe((0,u.R)(this.destroyed$),(0,p.w)(()=>this.softwaresFacade.allGames$)).subscribe(t=>{this.gamesCollectionIds=t.filter(a=>a.system===this.platform.id).map(a=>this.softwaresFacade.computeSoftwareId(a)),this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}addGame(t){const[a]=(0,S.$J)(t.name),r=this.getGameVersion(t),i={type:"game",system:this.platform.id,name:a,version:r,rom_name:t.name,rom_size:t.size,rom_source:"ipfs://"+t.cid,rom_crc:parseInt(t.crc,16),rom_md5:t.md5,rom_sha1:t.sha1,rom_sha256:t.sha256,atime:Date.now()};this.softwaresFacade.addGame(i),this.softwaresFacade.play(i)}gameToSoftwareRef(t){return{type:"game",system:this.platform.id,name:this.getGameName(t),version:this.getGameVersion(t)}}getGamesRegistry(t){const a=this.dataService.getGamesIndex(t.id);return this.softwaresService.readGamesIndex(a)}getGameLabel(t){return(0,x.C)(t.name)}getGameName(t){const[a]=(0,S.$J)(t.name);return a}getGameVersion(t){const[,...a]=(0,S.$J)(t.name);return a.map(i=>i.split(",").map(l=>l.trim()).join("_").replaceAll(/\s/g,"_")).join(" ")}getGameCrcDecimal(t){return(0,q.Z8)(t.crc)}getGameHumanSize(t){return(0,x.o)(t.size)}isGameInCollection(t){const a=this.softwaresFacade.computeSoftwareId(this.gameToSoftwareRef(t));return this.gamesCollectionIds.includes(a)}handleAddGame(t){this.gameSelected=null,this.changeDetectorRef.markForCheck(),this.addGame(t)}handleGameSelectedCancel(){this.gameSelected=null,this.changeDetectorRef.markForCheck()}handleSelectGame(t){this.gameSelected=t,this.changeDetectorRef.markForCheck()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36($.i),e.Y36(h.b),e.Y36(A.f),e.Y36(m.D),e.Y36(C.P),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-platform-store-page"]],hostVars:2,hostBindings:function(t,a){2&t&&e.ekj("platform-store-page",a.cssClassPlatformStorePage)},decls:4,vars:3,consts:[[1,"main-dialog-listbox"],[4,"ngIf"],["type","button","tabindex","0","class","listbox-button",3,"click",4,"ngFor","ngForOf"],["tabindex","-1","aria-hidden","true",1,"listbox-button"],[1,"ui-placeholder"],["type","button","tabindex","0",1,"listbox-button",3,"click"],["class","state",4,"ngIf"],[1,"state"],["uiModal","",3,"overlayKeydownEscape"],["role","alertdialog",1,"main-dialog","games-dialog",3,"uiAriaLabelledby"],[1,"main-dialog-title"],["storeDialogTitle",""],[1,"main-dialog-content"],["role","menubar",1,"main-dialog-actions"],["type","button","role","menuitem",1,"main-dialog-action",3,"disabled","click"]],template:function(t,a){1&t&&(e.TgZ(0,"section",0),e.YNc(1,R,31,0,"ng-container",1),e.YNc(2,L,7,6,"button",2),e.qZA(),e.YNc(3,E,1,0,null,1)),2&t&&(e.xp6(1),e.Q6J("ngIf",!a.loaded),e.xp6(1),e.Q6J("ngForOf",a.games),e.xp6(1),e.Q6J("ngIf",a.gameSelected))},dependencies:[c.sg,c.O5,P.N,D.V,c.Ov],encapsulation:2,changeDetection:0}),o})();var B=n(10538),H=n(32313);let y=(()=>{class o{constructor(t,a,r,i,l){this.router=t,this.dataService=a,this.softwaresService=r,this.routerFacade=i,this.softwaresFacade=l}canActivate(t){const a=t.paramMap.get("platform"),r=this.dataService.getGamesIndex(a);return this.softwaresService.isGamesIndexInstalled(r).pipe((0,B.M)(this.routerFacade.navigationId$,this.routerFacade.parentUrl$),(0,p.w)(([l,Z,oe])=>{if(l)return(0,f.of)(!0);const ne=Z<2,se=this.dataService.getPlatform(a);return(0,f.of)(!!ne&&this.router.createUrlTree([oe])).pipe((0,H.x)(()=>{this.softwaresFacade.installGamesIndexAsking(se)}))}))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(d.F0),e.LFG(m.D),e.LFG(C.P),e.LFG(A.f),e.LFG(h.b))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o})(),I=(()=>{class o{constructor(t){this.dataService=t}resolve(t){return`Stores - ${this.dataService.getPlatform(t.params.platform).shortName}`}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(m.D))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o})();var z=n(43271);function j(o,s){if(1&o&&(e.TgZ(0,"span",9),e._uU(1),e.qZA()),2&o){const t=e.oxw().ngIf;e.xp6(1),e.Oqu(t.name)}}function K(o,s){if(1&o&&(e.TgZ(0,"span",10),e._UZ(1,"span"),e.qZA()),2&o){const t=e.oxw().ngIf;e.xp6(1),e.Udp("width",100*t.progression,"%")}}function V(o,s){if(1&o&&(e.ynx(0),e.YNc(1,j,2,1,"span",7),e.YNc(2,K,2,2,"span",8),e.BQk()),2&o){const t=s.ngIf;e.xp6(1),e.Q6J("ngIf",t.name),e.xp6(1),e.Q6J("ngIf",t.progression>-1)}}const W=function(o){return["/stores",o]};function X(o,s){if(1&o&&(e.TgZ(0,"a",4)(1,"span",5),e._uU(2),e.qZA(),e._uU(3),e.YNc(4,V,3,2,"ng-container",6),e.ALo(5,"async"),e.qZA()),2&o){const t=s.$implicit,a=e.oxw();e.Q6J("routerLink",e.VKq(6,W,t.id)),e.xp6(2),e.Oqu(t.shortName||t.name),e.xp6(1),e.hij(" "," "," "),e.xp6(1),e.Q6J("ngIf",e.lcZ(5,4,a.softwaresFacade.selectGamesIndexState(t)))}}let U=(()=>{class o{constructor(t,a,r,i){this.dataService=t,this.settingsFacade=a,this.softwaresFacade=r,this.changeDetectorRef=i,this.cssClassStoresPage=!0,this.platformsHidden=["atarijaguar","atarist","msx","msx2","n64","sega32x","segacd"],this.platformsExcluded=["standalone","segacd"],this.platforms=[],this.destroyed$=new g.x}ngOnInit(){this.settingsFacade.dev$.subscribe(t=>{this.platforms=this.dataService.platforms.filter(a=>!this.platformsExcluded.includes(a.id)).filter(a=>t||!this.platformsHidden.includes(a.id)),this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}getGameLabel(t){return(0,x.C)(t.name)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.D),e.Y36(z.C),e.Y36(h.b),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-stores-page"]],hostVars:2,hostBindings:function(t,a){2&t&&e.ekj("stores-page",a.cssClassStoresPage)},decls:5,vars:2,consts:[["role","menu",3,"uiAriaLabelledby"],[1,"sr-only"],["platformsTitle",""],["role","menuitem","class","game-item","tabindex","0",3,"routerLink",4,"ngFor","ngForOf"],["role","menuitem","tabindex","0",1,"game-item",3,"routerLink"],[1,"label"],[4,"ngIf"],["class","state",4,"ngIf"],["class","progress",4,"ngIf"],[1,"state"],[1,"progress"]],template:function(t,a){if(1&t&&(e.TgZ(0,"section",0)(1,"h3",1,2),e._uU(3,"Platforms"),e.qZA(),e.YNc(4,X,6,8,"a",3),e.qZA()),2&t){const r=e.MAs(2);e.Q6J("uiAriaLabelledby",r),e.xp6(4),e.Q6J("ngForOf",a.platforms)}},dependencies:[c.sg,c.O5,d.yS,P.N,c.Ov],encapsulation:2,changeDetection:0}),o})();const ee=[],te=[U,v],F=[{path:"",pathMatch:"full",component:U,title:"Stores"},{path:":platform",component:v,canActivate:[y],title:I,data:{parentUrl:"auto"}}];let ae=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[y,I],imports:[c.ez,d.Bz.forChild(F),b.nZ,G.N,_.v]}),o})()}}]);
//# sourceMappingURL=apps_retroweb_src_app_features_stores_stores-feature_module_ts.0527d698d78c2c82.js.map